<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.8.0" type="image/png" sizes="32x32"><meta name="description" content="打开控制台，ctrl + c看一下 b 站图片的后缀&#x2F;格式，发现都是.webp后缀了。                      背景介绍       webp 是谷歌 2010 年整出来的, 是 jpeg, png 经过 webp 压缩算法后得到的, 它的压缩算法有 1. 无损 2. 有损 两种，无损肯定是质量牛一点比较贴近 jpeg, png 原来的画质, 有损讲体积压缩得狠一点，关">
<meta property="og:type" content="article">
<meta property="og:title" content="b站在用的webp是什么？怎么用？">
<meta property="og:url" content="https://niki571.github.io/b%E7%AB%99%E5%9C%A8%E7%94%A8%E7%9A%84webp%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E7%94%A8%EF%BC%9F/index.html">
<meta property="og:site_name" content="吴倩颖的网络日志">
<meta property="og:description" content="打开控制台，ctrl + c看一下 b 站图片的后缀&#x2F;格式，发现都是.webp后缀了。                      背景介绍       webp 是谷歌 2010 年整出来的, 是 jpeg, png 经过 webp 压缩算法后得到的, 它的压缩算法有 1. 无损 2. 有损 两种，无损肯定是质量牛一点比较贴近 jpeg, png 原来的画质, 有损讲体积压缩得狠一点，关">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/c49ccde1164d4b0ca5e617b3350b5010_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/fd808a0acdc449fe868798934d015aa1_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/d41bb85d15bb40f681a40a5994a506a1_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/6a3189181ede4920876aff409420db23_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/79e29ba0937e4e3390ed732ea6500552_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/80b053619ef14921bad5cbd7a80ceb2a_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/ca1f80e8744542e19b573c925d70b740_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/eca4eeacaa6b4987a88502dcc232cd11_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/fd808a0acdc449fe868798934d015aa1_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/605f1cdb454a4ec0a543f5cd75cca21a_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp">
<meta property="article:published_time" content="2022-08-21T08:13:15.000Z">
<meta property="article:modified_time" content="2023-02-21T09:08:29.479Z">
<meta property="article:author" content="WuQianying">
<meta property="article:tag" content="图片">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/niki571/MyImageHost/main/c49ccde1164d4b0ca5e617b3350b5010_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"><title>b站在用的webp是什么？怎么用？ | 吴倩颖的网络日志</title><link ref="canonical" href="https://niki571.github.io/b%E7%AB%99%E5%9C%A8%E7%94%A8%E7%9A%84webp%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E7%94%A8%EF%BC%9F/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"ocean","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: {"avoidBanner":true},
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-solid fa-pen-nib"></i></span><span class="header-nav-menu-item__text">文章</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/archives/"><span class="header-nav-submenu-item__icon"><i class="fas fa-solid fa-folder-open"></i></span><span class="header-nav-submenu-item__text">归档</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/"><span class="header-nav-submenu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-submenu-item__text">分类</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/tags/"><span class="header-nav-submenu-item__icon"><i class="fas fa-solid fa-tag"></i></span><span class="header-nav-submenu-item__text">标签</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/me/"><span class="header-nav-menu-item__icon"><i class="fas fa-solid fa-star"></i></span><span class="header-nav-menu-item__text">我</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">吴倩颖的网络日志</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">b站在用的webp是什么？怎么用？</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-08-21</span></span></div></header><div class="post-body"><p>打开控制台，<code>ctrl + c</code>看一下 b 站图片的后缀&#x2F;格式，发现都是<code>.webp</code>后缀了。</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/c49ccde1164d4b0ca5e617b3350b5010_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>

        <h1 id="背景介绍"   >
          <a href="#背景介绍" class="heading-link"><i class="fas fa-link"></i></a><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1>
      <p>webp 是谷歌 2010 年整出来的, 是 jpeg, png 经过 webp 压缩算法后得到的, 它的压缩算法有 1. 无损 2. 有损 两种，无损肯定是质量牛一点比较贴近 jpeg, png 原来的画质, 有损讲体积压缩得狠一点，关于具体压缩的体积比，可以看一下来自知乎的回答 WebP 相对于 PNG、JPG 有什么优势？, 这里就上一中其中的图：</p>
<span id="more"></span>

<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/fd808a0acdc449fe868798934d015aa1_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp"></p>
<p>注：本篇文章不会讨论 webp 算法的实现过程, 侧重于 webp 概念介绍以及使用</p>
<p>总而言之，webp 可以优化我们请求图片时的速度，图片越小下载越快，算是页面性能优化的一个点，所以 webp 能用来干什么？</p>

        <h1 id="webp-的用处"   >
          <a href="#webp-的用处" class="heading-link"><i class="fas fa-link"></i></a><a href="#webp-的用处" class="headerlink" title="webp 的用处"></a>webp 的用处</h1>
      <p>用于页面性能优化，优化页面图片加载速度，减小图片体积, 能保证压缩后的图片相对于原文件仍有较高的质量</p>

        <h1 id="webp-适用场景"   >
          <a href="#webp-适用场景" class="heading-link"><i class="fas fa-link"></i></a><a href="#webp-适用场景" class="headerlink" title="webp 适用场景"></a>webp 适用场景</h1>
      <p>页面需要渲染大量图片的时候，就有必要考虑一下 webp 了，我随机查看了几个内容型网站，京东, 哔哩哔哩, 淘宝, 掘金, 知乎回答部分，其中</p>
<ol>
<li>京东, 哔哩哔哩, 淘宝首页均采用了 webp 格式图片, 掘金文章内容和广告图片用的是 awebp(难道是 article webp?)</li>
<li>知乎回答内容里面并没有使用 webp 而是 jpg, 可能是默认一般人写回答的时候不会使用图片吧？</li>
</ol>

        <h1 id="webp-缺点"   >
          <a href="#webp-缺点" class="heading-link"><i class="fas fa-link"></i></a><a href="#webp-缺点" class="headerlink" title="webp 缺点"></a>webp 缺点</h1>
      <p>webp 并不是完美的, 它的缺点是它的兼容性和解码速度以及图片的保存上需要备份原图以备兼容处理, webp 解码速度比 jpg 慢 1.5 倍, 不过解码速度的优化上，应该交给浏览器，备份保存也不会讲，交给后端，兼容性的处理我们就能上手了, webp 兼容性的处理需要两个核心点</p>
<ol>
<li>检测用户浏览器是否支持 webp</li>
<li>丝滑般的切换 - webp to jpg - 降级处理</li>
</ol>

        <h1 id="检测是否支持"   >
          <a href="#检测是否支持" class="heading-link"><i class="fas fa-link"></i></a><a href="#检测是否支持" class="headerlink" title="检测是否支持"></a>检测是否支持</h1>
      
        <h2 id="Modernizr"   >
          <a href="#Modernizr" class="heading-link"><i class="fas fa-link"></i></a><a href="#Modernizr" class="headerlink" title="Modernizr"></a>Modernizr</h2>
      <p>这个<code>Modernizr</code>的原理就是支持的就在<code>HTML</code>上加上表示支持的类名，不支持的就加不支持的类名，<code>Modernizr</code>需要下载 npm 自行打包，我暂时没有发现到相关的 CDN 像<code>jsdeliver</code>上面都没有， Modernizr github 链接 ，在 github 上通过相应的配置文件自己挑选并生成对应的 js 文件，模块化算是给它玩明白了</p>
<p>PS: Modernizr github 上的 build 教程不是很人性化，不想看的可以直接按照我下面这段 js 操作</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm install modernizr</span></span><br><span class="line"><span class="comment">// 在当前文件目录下生成 modernizr.js</span></span><br><span class="line"><span class="keyword">var</span> modernizr = <span class="built_in">require</span>(<span class="string">&quot;modernizr&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">modernizr.<span class="title function_">build</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;feature-detects&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;img/webp-alpha&quot;</span>,</span><br><span class="line">      <span class="string">&quot;img/webp-animation&quot;</span>,</span><br><span class="line">      <span class="string">&quot;img/webp-lossless&quot;</span>,</span><br><span class="line">      <span class="string">&quot;img/webp&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">writeFile</span>(<span class="string">&quot;modernizr.js&quot;</span>, result, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></div></figure>

<p>让我们小试一下，在这里先感谢一下老朋友 IE 为兼容性处理对比上做出的贡献, 参考下面的示例代码</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./modernizr.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-tag">div</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">height</span>: <span class="number">380px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">width</span>: <span class="number">400px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.no-webp</span> <span class="selector-tag">div</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;./img/img.png&quot;</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.webp</span> <span class="selector-tag">div</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;./img/img.png&quot;</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></div></figure>

<p>其效果如下</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/d41bb85d15bb40f681a40a5994a506a1_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/6a3189181ede4920876aff409420db23_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>
<p>注意看右边样式和<code>style</code>里面的显示的图片链接后缀，IE 是<code>.jpg</code>而 Chrome 的是<code>.webp</code>说明我们的<code>Modernizr</code>生效了，而<code>Modernizr</code>的作用方式也就是通过在<code>HTML</code>上添加<code>class</code>类名并搭配自定义的 CSS 代码实现<code>webp</code>和<code>jpg</code>切换处理，不支持类名就是<code>no-webp</code>，支持就是<code>webp</code></p>
<p>Modernizr 检测到浏览器后会给 HTML 加上类名, 然后我们就可以丝滑般的切换了，不过我个人认为并不是很实用, 依赖于 CSS 和 HTML 的切换太过繁琐，往往后端都是传递动态的链接给前端，今天明天不一样的链接，url 随时会换，这种方案此时就不起作用了，而且依赖于 Modernizr 的检测，万一不能用 JS 或者因为 First Plain 导致 FOUC 样式闪烁导致背景图左右横跳反而会得不偿失</p>
<p>注：大多数同类文章中，仙人指路去 Modernizr 下载文件，但是现在它的官网已经失效了，应该去 npm 下载自己构建</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/79e29ba0937e4e3390ed732ea6500552_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>

        <h3 id="适用场景"   >
          <a href="#适用场景" class="heading-link"><i class="fas fa-link"></i></a><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3>
      <p>静态图片, 如主页背景图等一些不易变换的图片</p>

        <h2 id="HTML5-lt-picture-gt"   >
          <a href="#HTML5-lt-picture-gt" class="heading-link"><i class="fas fa-link"></i></a><a href="#HTML5-lt-picture-gt" class="headerlink" title="HTML5 - &lt;picture&gt;"></a>HTML5 - <code>&lt;picture&gt;</code></h2>
      <p><code>&lt;picture&gt;</code>是 HTML5 中新增的一个标签，它的原理是利用浏览器是否支持图片格式（type），因此在 HTML5 可以帮你自动选是<code>webp</code>还是<code>jpg</code>, <code>png</code>等其他格式，缺点是不能用在<code>background-image</code>属性上，这种情况可以和<code>Modernizr</code>折中一下</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;./img/image.webp&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/webp&quot;</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;./img/image.jpg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/jpeg&quot;</span> /&gt;</span></span></span><br><span class="line">  &lt;!-- 默认值 --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./img/image.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;img&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/picture&gt;</span><br></pre></td></tr></table></div></figure>

<p>这种方式直接在 HTML 上是看不了到底是渲染哪个图片了的，但是不要紧，小细节，我们请求了图片，那么在 network 上一定有相应的请求发送，Chrome 效果如下</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/80b053619ef14921bad5cbd7a80ceb2a_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>
<p>IE 的比较麻烦，Element 上看不到，Network 上也看不到，但是我最终还是通过将图片另存为这种方式知道了 IE 最后渲染得到图片格式</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/ca1f80e8744542e19b573c925d70b740_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>

        <h2 id="通过请求判断"   >
          <a href="#通过请求判断" class="heading-link"><i class="fas fa-link"></i></a><a href="#通过请求判断" class="headerlink" title="通过请求判断"></a>通过请求判断</h2>
      <p>知名摆烂选手 IE 发送图片请求时, 请求标头属性中 Accept 是这样的</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/eca4eeacaa6b4987a88502dcc232cd11_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>
<p>Chrome 请求标头属性中 Accept 是这样的</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/fd808a0acdc449fe868798934d015aa1_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp"></p>
<p>后端看到这个还不分分钟钟拿捏？需要返回什么，要和前端怎么做商量好就行了</p>

        <h1 id="降级处理"   >
          <a href="#降级处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#降级处理" class="headerlink" title="降级处理"></a>降级处理</h1>
      <p>有京东选手登场</p>
<p><img src="https://raw.githubusercontent.com/niki571/MyImageHost/main/605f1cdb454a4ec0a543f5cd75cca21a_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.webp"></p>
<p>看到没有，图片的后缀是 .jpg.webp, 前面已经讲过了检测是否支持的方法，当我们知道能不能用之后，就可以对链接字符串操作了，支持你就改成 jpg 不支持不改</p>

        <h1 id="最佳方案？"   >
          <a href="#最佳方案？" class="heading-link"><i class="fas fa-link"></i></a><a href="#最佳方案？" class="headerlink" title="最佳方案？"></a>最佳方案？</h1>
      <p>还是来自京东的选手啊，这是他们文章里面给出的方案, 可以通过谷歌开发的 PageSpeed 去自动转换，省去保存备份和转换的麻烦, 它最终的效果就是源码你可以写带 jpg 的, nginx 开启 PageSpeed 配置后, 会对你的原生的 HTML 做出一点点改变</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 源码 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./574ceeb8N73b24dc2.jpg&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./6597241290470949609.png&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line">&lt;!-- 支持 webp - 用户实际接收到的 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x574ceeb8N73b24dc2.jpg.pagespeed.ic.YcCPjxQL4t.webp&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x6597241290470949609.png.pagespeed.ic.6c5y5LYYUu.webp&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line">&lt;!-- 不支持 webp - 用户实际接收到的 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x574ceeb8N73b24dc2.jpg.pagespeed.ic.3TXX_PUg99.jpg&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x6597241290470949609.png.pagespeed.ic.rrgw7vPMd6.png&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></div></figure>

<p>又是一个提示幸福感的小技巧啊</p>

        <h1 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>是否需要考虑 webp 的图片方案，取决于你的页面，如果文字占比比较重的比如知乎，你上 webp 会不会是对你一种身心摧残，因为你可能弄半天看不到页面加载的效果，如果你全是图片而且页面加载还慢的一批，可以考虑一下 webp</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://niki571.github.io/tags/%E5%9B%BE%E7%89%87/">图片</a></span></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/Flutter%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89-%20Element/"><span class="paginator-prev__text">Flutter 源码解析（三）Element</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">
          背景介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webp-%E7%9A%84%E7%94%A8%E5%A4%84"><span class="toc-number">2.</span> <span class="toc-text">
          webp 的用处</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webp-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.</span> <span class="toc-text">
          webp 适用场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webp-%E7%BC%BA%E7%82%B9"><span class="toc-number">4.</span> <span class="toc-text">
          webp 缺点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81"><span class="toc-number">5.</span> <span class="toc-text">
          检测是否支持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Modernizr"><span class="toc-number">5.1.</span> <span class="toc-text">
          Modernizr</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">5.1.1.</span> <span class="toc-text">
          适用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML5-lt-picture-gt"><span class="toc-number">5.2.</span> <span class="toc-text">
          HTML5 - &lt;picture&gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%AF%B7%E6%B1%82%E5%88%A4%E6%96%AD"><span class="toc-number">5.3.</span> <span class="toc-text">
          通过请求判断</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%8D%E7%BA%A7%E5%A4%84%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">
          降级处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E6%96%B9%E6%A1%88%EF%BC%9F"><span class="toc-number">7.</span> <span class="toc-text">
          最佳方案？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">
          总结</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/avatar.JPEG" alt="avatar"></div><p class="sidebar-ov-author__text">Keep Studying, Keep Creating</p></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>WuQianying</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v6.3.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.0</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/ribbon.js@latest/dist/ribbon.min.js" size="120" alpha="0.6" zIndex="-1"></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', function () {
  var pjax = new Pjax({"selectors":["head title","#main",".pjax-reload",".header-banner"],"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0});
  // 加载进度条的计时器
  var loadingTimer = null;

  // 重置页面 Y 方向上的滚动偏移量
  document.addEventListener('pjax:send', function () {
    $('.header-nav-menu').removeClass('show');
    if (CONFIG.pjax && CONFIG.pjax.avoidBanner) {
      $('html').velocity('scroll', {
        duration: 500,
        offset: $('#header').height(),
        easing: 'easeInOutCubic'
      });
    }

    var loadingBarWidth = 20;
    var MAX_LOADING_WIDTH = 95;

    $('.loading-bar').addClass('loading');
    $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    clearInterval(loadingTimer);
    loadingTimer = setInterval(function () {
      loadingBarWidth += 3;
      if (loadingBarWidth > MAX_LOADING_WIDTH) {
        loadingBarWidth = MAX_LOADING_WIDTH;
      }
      $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    }, 500);
  }, false);

  window.addEventListener('pjax:complete', function () {
    clearInterval(loadingTimer);
    $('.loading-bar__progress').css('width', '100%');
    $('.loading-bar').removeClass('loading');
    setTimeout(function () {
      $('.loading-bar__progress').css('width', '0');
    }, 400);
    $('link[rel=prefetch], script[data-pjax-rm]').each(function () {
      $(this).remove();
    });
    $('script[data-pjax], #pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });

    if (Stun.utils.pjaxReloadBoot) {
      Stun.utils.pjaxReloadBoot();
    }
    if (Stun.utils.pjaxReloadScroll) {
      Stun.utils.pjaxReloadScroll();
    }
    if (Stun.utils.pjaxReloadSidebar) {
      Stun.utils.pjaxReloadSidebar();
    }
    if (false) {
      if (Stun.utils.pjaxReloadHeader) {
        Stun.utils.pjaxReloadHeader();
      }
      if (Stun.utils.pjaxReloadScrollIcon) {
        Stun.utils.pjaxReloadScrollIcon();
      }
      if (Stun.utils.pjaxReloadLocalSearch) {
        Stun.utils.pjaxReloadLocalSearch();
      }
    }
  }, false);
}, false);</script><div id="pjax-reload"></div><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script></body></html>